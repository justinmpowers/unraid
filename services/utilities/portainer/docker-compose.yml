services:
  portainer:
    image: portainer/portainer-ce:2.39.0
    container_name: portainer
    restart: unless-stopped
    environment:
    - TZ=${TZ}
    - HOST_OS=Unraid
    - HOST_HOSTNAME=JP-Dell
    - HOST_CONTAINERNAME=portainer
    volumes:
    - ${APPDATA_PATH}/portainer:/data
    - /var/run/docker.sock:/var/run/docker.sock:ro
    - /mnt/user/appdata/docker-compose:/compose:ro
    ports:
    - 9444:9443
    - 9002:9000
    - 8002:8000
    networks:
    - monitoring_net
    - internal_net
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 256M
        reservations:
          cpus: '0.1'
          memory: 128M
    labels:
    - traefik.enable=true
    - traefik.docker.network=internal_net
    - traefik.http.routers.portainer.rule=Host(`portainer.${DOMAIN}`)
    - traefik.http.routers.portainer.entrypoints=web
    - traefik.http.routers.portainer.middlewares=crowdsec@file
    - traefik.http.services.portainer.loadbalancer.server.port=9000
    - kuma.portainer.type=http
    - kuma.portainer.url=http://portainer:9000
    - kuma.portainer.name=Portainer
    - kuma.portainer.interval=60
    - kuma.portainer.keyword=Portainer
    - kuma.portainer.tags=utilities,docker-management
    - net.unraid.docker.icon=https://raw.githubusercontent.com/selfhosted/unRAID-CA-templates/master/templates/img/portainer-icon.png
    - net.unraid.docker.webui=http://[IP]:[PORT:9000]
    healthcheck:
      test:
      - CMD-SHELL
      - wget --no-verbose --tries=1 --spider https://localhost:9443 || exit 1
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    security_opt: []
networks:
  monitoring_net:
    external: true
  internal_net:
    external: true
